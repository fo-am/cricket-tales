{% extends "base.html" %}
{% load i18n %}

{% block top_layer %}

{% if houses_needed_for %}
<!-- just trigger the first one, if there are more they will
     pop up each load of the map until they are all done -->

<div id="movie_end" class="movie_end" style="visibility:hidden;">

<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.css"/>
<script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.min.js"></script>


<div class="row-fluid">
	<div class="row-fluid col-lg-12">
		<div class="arrow arrow-roof-left col-lg-2 col-lg-offset-1">
			<img src="/media/images/left-arrow.png" width="150"/>
		</div>
		<div class="slider-roof col-lg-5">
			<div class="col-lg-2"><img src="/media/images/houses/components/house-1-roof-pink.png" class="thumbnail a" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-2-roof-pink.png" class="thumbnail b" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-3-roof-pink.png" class="thumbnail c" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-4-roof-pink.png" class="thumbnail d" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-5-roof-pink.png" class="thumbnail e" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-6-roof-pink.png" class="thumbnail f" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-7-roof-pink.png" class="thumbnail g" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-8-roof-pink.png" class="thumbnail h" width="150"></div>
		</div>
		<div class="arrow arrow-roof-right col-lg-2">
			<img src="/media/images/right-arrow.png" width="150"/>
		</div>
	</div>
	<div class="row-fluid col-lg-12">
		<div class="arrow arrow-middle-left col-lg-2 col-lg-offset-1">
			<img src="/media/images/left-arrow.png" width="150"/>
		</div>
		<div class="slider-middle col-lg-5">
			<div class="col-lg-2"><img src="/media/images/houses/components/house-1-middle-pink.png" class="thumbnail a" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-2-middle-pink.png" class="thumbnail b" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-3-middle-pink.png" class="thumbnail c" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-4-middle-pink.png" class="thumbnail d" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-5-middle-pink.png" class="thumbnail e" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-6-middle-pink.png" class="thumbnail f" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-7-middle-pink.png" class="thumbnail g" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-8-middle-pink.png" class="thumbnail h" width="150"></div>
		</div>
		<div class="arrow arrow-middle-right col-lg-2">
			<img src="/media/images/right-arrow.png" width="150"/>
		</div>
	</div>
	<div class="row-fluid col-lg-12">
		<div class="arrow arrow-ground-left col-lg-2 col-lg-offset-1">
			<img src="/media/images/left-arrow.png" width="150"/>
		</div>
		<div class="slider-ground col-lg-5">
			<div class="col-lg-2"><img src="/media/images/houses/components/house-1-ground-pink.png" class="thumbnail a" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-2-ground-pink.png" class="thumbnail b" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-3-ground-pink.png" class="thumbnail c" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-4-ground-pink.png" class="thumbnail d" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-5-ground-pink.png" class="thumbnail e" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-6-ground-pink.png" class="thumbnail f" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-7-ground-pink.png" class="thumbnail g" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/components/house-8-ground-pink.png" class="thumbnail h" width="150"></div>
		</div>
		<div class="arrow arrow-ground-right col-lg-2">
			<img src="/media/images/right-arrow.png" width="150"/>
		</div>
	</div>
	<div class="row-fluid col-xs-12">
		<div class="arrow arrow-colour-left col-lg-2 col-lg-offset-1">
			<img src="/media/images/left-arrow.png" width="150"/>
		</div>
		<div class="slider-colour col-lg-5">
			<div class="col-lg-2"><img src="/media/images/houses/colours/blue.png" class="thumbnail a" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/brown.png" class="thumbnail b" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/green.png" class="thumbnail c" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/grey.png" class="thumbnail d" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/orange.png" class="thumbnail e" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/pink.png" class="thumbnail f" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/purple.png" class="thumbnail g" width="150"></div>
			<div class="col-lg-2"><img src="/media/images/houses/colours/yellow.png" class="thumbnail h" width="150"></div>
		</div>
		<div class="arrow arrow-colour-right col-lg-2">
			<img src="/media/images/right-arrow.png" width="150"/>
		</div>
	</div>
	<div class="row-fluid col-xs-12">
		<button class="col-lg-2 col-lg-offset-3 submit">Submit</button>
	</div>
</div>

 <script type="text/javascript">
    $(document).ready(function() {

    	var classes = ['roof', 'middle', 'ground', 'colour'];

    	$(classes).each(function() {
/*    		$('.slider-' + this).slick({
				centerMode: true,
				centerPadding: '120px',
				arrows: true,
				prevArrow: $('.arrow-'+this+'-left'),
				nextArrow: $('.arrow-'+this+'-right')
			});
*/    	});

    	$('.submit').click(function() {
/*
    		var select_roof = $('.slider-roof .slick-active img').attr('class').split(' ')[1];
    		var select_middle = $('.slider-middle .slick-active img').attr('class').split(' ')[1];
    		var select_ground = $('.slider-ground .slick-active img').attr('class').split(' ')[1];
    		var select_colour = $('.slider-colour .slick-active img').attr('class').split(' ')[1];

    		var final_house = select_roof + select_middle + select_ground + select_colour;

            console.log(final_house)
*/
            $.post("/update_house/", {
                burrow: {{ houses_needed_for.first.id }},
                house: "aaaa",
                user: {{ user.id }},
            });
    	})
    });
  </script>

</div>

 {% endif %}

{% endblock %}

{% block bottom_layer %}
<link rel="stylesheet" href="{{MEDIA_URL}}css/leaflet.css" />

<div class="row">
  <!-- map -->
  <div class="col-sm-8 col-xs-12">
      <div id="map" class="row-fluid" style="height:500px;"></div>

      <script src="{{MEDIA_URL}}/js/leaflet.js"></script>

      <script>


        function create_marker(pos_x, pos_y, name, num_movies_ready, num_contributors, num_movies_watched, num_movies_unwatched, id, house) {
          var lat_string = pos_x;
          var long_string = pos_y;
          var latitude = parseFloat(lat_string);
          var longitude = parseFloat(long_string);

          // Default marker
          var marker = L.marker(new L.LatLng(latitude, longitude), {
            icon: L.icon({
                iconUrl: '{{MEDIA_URL}}'+image_from_house(house),
                iconSize: size_from_house(house,map.getZoom()),
            })
          });


          var popup_title = '<h4>{% trans 'Burrow' %} '+name+'</h4><br/>';
          var total_videos = '<strong>{% trans 'Total Videos:' %} </strong> '+ num_movies_ready +'<br/>';
          var total_contributors = '<strong>{% trans 'Total Contributors:' %} </strong> '+ num_contributors +'<br/>';
          var total_videos_watched = '<strong>{% trans 'Total Videos Watched:' %} </strong> '+ num_movies_watched +'<br/>';
          var total_videos_unwatched = '<strong>{% trans 'Total Videos Unwatched:' %} </strong> '+ num_movies_unwatched +'<br/>';
          var burrow_button = '<form action="/random_burrow_movie/'+id+'"><input type="submit" class="burrow_link" value="{% trans 'Go to Burrow' %}"></form>'

          marker.bindPopup(popup_title + total_videos + total_contributors + total_videos_watched + total_videos_unwatched + burrow_button);

          marker.addTo(map);

          // The bizznizz
          map.on('zoomend', function (e) {
            new_icon(map.getZoom());
          });

        function new_icon(zoom) {
            var icon = marker.options.icon;
            icon.options.iconSize = size_from_house(house,zoom);
            console.log(house)
            icon.options.iconUrl = '{{MEDIA_URL}}'+image_from_house(house)
            marker.setIcon(icon);
        }

        }

        $(document).ready(function() {

        map = L.map('map').setView([0, 0], 4);
        L.tileLayer('{{MEDIA_URL}}map/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 6,
            attribution: 'Cricket Burrow Surveys Ltd',
            tms: true
        }).addTo(map);

    {% for burrow in burrows %}
      create_marker('{{ burrow.pos_x }}', '{{ burrow.pos_y }}', '{{ burrow.name }}', '{{ burrow.num_movies_ready }}', '{{ burrow.num_contributors }}', '{{ burrow.num_contributors }}', '{{ burrow.num_movies_watched }}', '{{ burrow.id }}', '{{burrow.house_info}}');
    {% endfor %}


        });
    </script>



  </div> <!-- map -->

  <div class="col-sm-4 col-xs-12"> <!-- info block -->
    <div class="score row-fluid">
      <h1>{% trans "SCORE" %}</h1>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Videos watched" %}</div>
      <div class="score-value col-sm-3">{{ movies.count }}</div>
      </div>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Houses built" %}</div>
      <div class="score-value col-sm-3">0</div>
      </div>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Empty burrows" %}</div>
      <div class="score-value col-sm-3">999</div>
      </div>

      {% if houses_needed_for %}
      <!-- just trigger the first one, if there are more they will
           pop up each load of the map until they are all done -->
      <script>$("#movie_end").css("visibility", "visible");</script>
      {% endif %}

    </div>



    <div class="news-feed row-fluid">
      <h1>{% trans "NEWS FEED" %}</h1>

      {% for story in stories %}
      <p>{{story.text}}</p>
      {% endfor %}


    </div>
  </div> <!-- info block -->
</div> <!-- main row -->

<!--
<h2>Movies seen</h2>
<div class="box_container">
{% if movies %}
{% for movie in movies %}
    <a href="/movie/{{ movie.movie.id }}/">
      <div class="box" style="background:url({{ MEDIA_URL }}movies/{{ movie.movie.name }}.jpg)">
        <div class="box-overlay"></div>
        <div class="box-contents">
          Movie: {{ movie.movie.name }}</br>
        </div>
      </div>
    </a>
    {% endfor %}
    {% else %}
<p>This player has not contributed to any movies yet.</p>
{% endif %}
</div>
-->

{% endblock %}
