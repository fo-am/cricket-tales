{% extends "base.html" %}
{% load i18n %}

{% block top_layer %}
{% endblock %}

{% block bottom_layer %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />

<div class="row">
  <!-- map -->
  <div class="col-sm-8 col-xs-12">
      <h1>{% blocktrans %}{{ user.username }}'s burrow map{% endblocktrans %}</h1>

      <div id="map" class="row-fluid" style="height:500px;"></div>

      <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

      <script>
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('{{MEDIA_URL}}map/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 6,
            attribution: 'Cricket Burrow Surveys Ltd',
            tms: true
        }).addTo(map);
    </script>

    {% for burrow in burrows %}
    <script>
      var lat_string = '{{ burrow.pos_x }}';
      var long_string = '{{ burrow.pos_y }}';
      var latitude = parseFloat(lat_string);
      var longitude = parseFloat(long_string);
      
      var random_file_no = Math.floor(Math.random() * (7 - 1 + 1)) + 1;

      var marker = L.marker(new L.LatLng(latitude, longitude), {
        icon: L.icon({
            iconUrl: '{{MEDIA_URL}}images/burrows/burrow-'+random_file_no+'.png',
            iconSize: [20, 15],
        })
      });

      var popup_title = '<strong>Burrow {{ burrow.name }}</strong><br/>';
      var total_videos = '<strong>Total Videos: </strong> {{ burrow.num_movies_ready }}<br/>';
      var total_contributors = '<strong>Total Contributors: </strong> {{ burrow.num_contributors }}<br/>';
      var total_videos_watched = '<strong>Total Videos Watched: </strong> {{ burrow.num_movies_watched }}<br/>';
      var total_videos_unwatched = '<strong>Total Videos Watched: </strong> {{ burrow.num_movies_unwatched }}<br/>';

      marker.bindPopup(popup_title + total_videos + total_contributors + total_videos_watched + total_videos_unwatched);
      marker.on('mouseover', function (e) {
          this.openPopup();
      });
      marker.on('mouseout', function (e) {
          this.closePopup();
      });

      marker.addTo(map);
    </script>
    {% endfor %}

  </div> <!-- map -->

  <div class="col-sm-4 col-xs-12"> <!-- info block -->
    <div class="score row-fluid">
      <h1>{% trans "SCORE" %}</h1>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Videos tagged" %}</div>
      <div class="score-value col-sm-3">{{ movies.count }}</div>
      </div>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Houses built" %}</div>
      <div class="score-value col-sm-3">0</div>
      </div>
      <div class="row">
      <div class="score-name col-sm-6">{% trans "Empty burrows" %}</div>
      <div class="score-value col-sm-3">999</div>
      </div>
    </div>

    

    <div class="news-feed row-fluid">
      <h1>{% trans "NEWS FEED" %}</h1>
    </div>
  </div> <!-- info block -->
</div> <!-- main row -->

<!--
<h2>Movies seen</h2>
<div class="box_container">
{% if movies %}
{% for movie in movies %}
    <a href="/movie/{{ movie.movie.id }}/">
      <div class="box" style="background:url({{ MEDIA_URL }}movies/{{ movie.movie.name }}.jpg)">
        <div class="box-overlay"></div>
        <div class="box-contents">
          Movie: {{ movie.movie.name }}</br>
        </div>
      </div>
    </a>
    {% endfor %}
    {% else %}
<p>This player has not contributed to any movies yet.</p>
{% endif %}
</div>
-->

{% endblock %}
